package com.example.habitathumanityapp;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.InputStreamReader;

import org.simpleframework.xml.Serializer;
import org.simpleframework.xml.core.Persister;

import android.content.Context;
import android.util.Log;

public class XMLParser {
	
	public static Form parseForm(String xml){
		Form f = null;
		
		Serializer serializer = new Persister();
		
		//Look into serialization/deserialization of objects
		try{
			f = serializer.read(Form.class, xml);

			/*for( Question q: f.questions){
				System.out.println(q.getClass());
			}*/
		}catch(Exception e){
			e.printStackTrace();
		}	
		return f;
	}
	
	public static String getXML(Form f, Context ctx){
		FileOutputStream fos = null;
		FileInputStream fis = null;
		
		String FILENAME = "testForm";
		String fullXml = "Form not created.";
		StringBuilder sb = new StringBuilder();
		
		// Open private file to write XML.
		try{
			fos = ctx.openFileOutput(FILENAME, Context.MODE_PRIVATE	);
		}
		catch(Exception e){
			e.printStackTrace();
		}
		
		// Create XML file using Simple XML Serializer.
		Serializer serializer = new Persister();
		String xmlChunk = "";
		try
		{
			serializer.write(f, fos);
		}
		catch(Exception e){
			e.printStackTrace();
		}
		
		// Open file to read XML into a string.
		try{
			fis = ctx.openFileInput(FILENAME);
			
			Log.v("Parser", "here is file length" + fis.available() );

			BufferedReader br = new BufferedReader( new InputStreamReader(fis));
	
			while((xmlChunk = br.readLine()) != null){
				//Log.v("Parser", "Going through while loop with chunk" + xmlChunk);
				sb.append(xmlChunk);
			}
		}
		catch(Exception e){
			e.printStackTrace();
		}
		
		
		fullXml = sb.toString();
		
		return fullXml;
	}
	
}
