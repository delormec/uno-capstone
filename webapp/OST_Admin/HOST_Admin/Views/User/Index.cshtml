@*
    Screen:         User/Index
    Description:    Displays interface to access all aspects of User management.
                    Only the administrator user has access to this area.
    Input:          (IQueryable<User>) Model.
                        List of all Users currently in the system.
    Output:         GET: User/Delete
                    GET: User/Add
                    GET: User/Edit
*@
@model IQueryable<HOST_Admin.Models.User>
@{
    ViewBag.Title = "Index";
}
<div id = "form-index-outer">
<div class="header ui-widget-header ui-corner-top">User Management</div>
<div id ="form-index" class="ui-corner-bottom ui-widget-content ui-widget">
<table id="form-index-table">
    <thead>
    <tr>
        <th>
            ID
        </th>
        <th>
            User Name
        </th>
        <th>
            Role
        </th>
        <th>
            Active
        </th>
        <th></th>
    </tr>
    </thead>
        <tbody>
@* Loop through each User to create a row in the table *@
@foreach (var item in Model.OrderBy(p => p.Active).ThenBy(x => x.Role.RoleId).ThenBy(n => n.UserId))
{

    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.UserId)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.UserName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Role.Name)
        </td>
        <td>
            @if (item.Active == false)
            {
                <text>inactive</text>
            }
            else
            {
                <text>active</text>
            }
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.UserId})&nbsp;|&nbsp;@Html.ActionLink("Delete", "Delete", new { id = item.UserId }, new { @class = "user-btn-delete" })
        </td>
    </tr>

}
    </tbody>
</table>

</div>
@Html.ActionLink("Add New User", "Add", null,  new { id = "user-btn-add" })
</div>

@* Dialog pop-up to confirm delete action. *@
<div id="user-delete-confirm" title="Delete this user?" class="dialog">
    <p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>This user will be permanently deleted and cannot be recovered. Are you sure?</p>
</div>

@* JQuery *@
@section Scripts {
<script>
    $(function () {
        $("a[id=user-btn-add]").button();

        //set up table with custom css / sortable columns / default sorting
        $("#form-index-table").dataTable({
            "bJQueryUI": true,
            "bPaginate": false,
            "aaSorting": [[3, "asc"],[2, "asc"], [3, "asc"]],
            "aoColumns": [
                { "bSortable": true },
                { "bSortable": true },
                { "bSortable": true },
                { "bSortable": true },
                { "bSortable": false}]
        });

        //dialog settings
        $("#user-delete-confirm").dialog({
            autoOpen: false,
            resizable: false,
            //height: 140,
            modal: true
        });

        //set up click event for each delete button
        $(".user-btn-delete").each(function () {
            $(this).click(function (e) {
                e.preventDefault();
                var href = $(this).attr("href");
                $("#user-delete-confirm").dialog('option', 'buttons', {
                    "Delete User": function () {
                        window.location.href = href;
                    },
                    Cancel: function () {
                        $(this).dialog("close");
                    }
                });
                $("#user-delete-confirm").dialog("open");
            });
        });
    });
</script>
}