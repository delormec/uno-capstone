@model OST_Admin.Models.Form

@{
    ViewBag.Title = "Edit Form";
    int fid = ViewBag.formId;
}

<h2>Edit Form</h2>

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Form</legend>

        @Html.HiddenFor(model => model.FormId)
        @Html.HiddenFor(model => model.Deleted)
        @Html.HiddenFor(model => model.Content)
        @Html.HiddenFor(model => model.DateCreated)

        <div class="editor-label">
            @Html.LabelFor(model => model.Name)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.Name)
            @Html.ValidationMessageFor(model => model.Name)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.Description)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.Description)
            @Html.ValidationMessageFor(model => model.Description)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.URL)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.URL)
            @Html.ValidationMessageFor(model => model.URL)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.AutoUpdate)
        </div>
        
        @{
            //true/false button set
            <div id="AutoUpdateButtonSet">
             @if (Model.AutoUpdate == true)
             {
                <input type="radio" id="AutoUpdate1" name="AutoUpdate" value="true" checked="checked"/><label for="AutoUpdate1">True</label>
                <input type="radio" id="AutoUpdate2" name="AutoUpdate" value="false" /><label for="AutoUpdate2">False</label>
             }
             else
             {
                <input type="radio" id="AutoUpdate1" name="AutoUpdate" value="true" /><label for="AutoUpdate1">True</label>
                <input type="radio" id="AutoUpdate2" name="AutoUpdate" value="false" checked="checked"/><label for="AutoUpdate2">False</label>
             }
             </div>
        }
        
        <fieldset>
        <legend>Questions</legend>
        @{
            <div id="Questions">

                @Html.Partial("_QuestionList", Model.Questions)

            </div>
        }
        </fieldset>
       <input type="submit" id="Save" value="Save Form" />

       @Html.JQueryUI().Button("test")

       @Ajax.ActionLink("Add a Text Question", "AddQuestion", new { formId = fid, type = "Text" }, new AjaxOptions { InsertionMode = InsertionMode.Replace, OnSuccess = "OnSuccess" })
       @Ajax.ActionLink("Add a Choice Question", "AddQuestion", new { formId = fid, type = "Choice" }, new AjaxOptions { UpdateTargetId = "Questions", InsertionMode = InsertionMode.Replace, OnSuccess = "function() {RefreshJQuery();}" })
       @Ajax.ActionLink("Add a Likert Question", "AddQuestion", new { formId = fid, type = "Likert" }, new AjaxOptions { UpdateTargetId = "Questions", InsertionMode = InsertionMode.Replace, OnSuccess = "function() {RefreshJQuery();}" })
       

    </fieldset>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {

<script>



    function OnSuccess(html) {
        $('#Questions').html(html);
    }

    RefreshJQuery();


    function RefreshJQuery() {
        $(function () {
            //$("input[type=submit], button").button().click(function (event) {
            //event.preventDefault();
            //});

            $("#QuestionsInner").livequery(function () {
                $(this).accordion({
                    header: "div > h3",
                    active: false,
                    collapsible: true,
                    heightStyle: "content",
                })
            .sortable({
                axis: "y",
                handle: "h3",
                stop: function (event, ui) {
                    // IE doesn't register the blur when sorting
                    // so trigger focusout handlers to remove .ui-state-focus
                    ui.item.children("h3").triggerHandler("focusout");

                }


            });
                
            });

            $("#AutoUpdateButtonSet").livequery(function(){
                $(this).buttonset(); });

            $("div[class*=OtherSet]").livequery(function(event){
               $(this).buttonset(); });

             //$("div[class*=OtherSet]").each(function(){
             //    $(this).buttonset();  });

            // $("div[class*=OtherSet]").buttonset();

            /*$("#Questions")
            .accordion({
            header: "> div > h3"
            })
            .sortable({
            axis: "y",
            handle: "h3",
            stop: function (event, ui) {
            // IE doesn't register the blur when sorting
            // so trigger focusout handlers to remove .ui-state-focus
            ui.item.children("h3").triggerHandler("focusout");

            }
            });
            */
        });
    }
</script>
}
